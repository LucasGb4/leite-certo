<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; font-src https://fonts.gstatic.com; connect-src https://*.supabase.co; img-src 'self' data:;">
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>Leite Certo üêÑ</title>
  <meta name="theme-color" content="#14532d"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Leite Certo"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --green:     #16a34a;
      --green-dk:  #14532d;
      --green-mid: #166534;
      --green-lt:  #dcfce7;
      --cream:     #fafaf7;
      --stone:     #1c1917;
      --muted:     #78716c;
      --border:    #e7e5e0;
      --white:     #ffffff;
      --red:       #dc2626;
      --red-lt:    #fee2e2;
      --gold:      #b45309;
      --gold-lt:   #fef3c7;
      --blue:      #0284c7;
      --blue-lt:   #e0f2fe;
      --purple:    #7c3aed;
      --r:         16px;
      --sh:        0 4px 20px rgba(0,0,0,.05);
      --sh-lg:     0 12px 48px rgba(0,0,0,.12);
    }
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--stone);min-height:100vh;overflow-x:hidden}
    h1,h2,h3{font-family:'Playfair Display',serif}

    /* SVG ICONS BASE */
    .svg-icon { width: 24px; height: 24px; fill: currentColor; vertical-align: middle; }
    .svg-icon-sm { width: 18px; height: 18px; }
    .svg-icon-lg { width: 48px; height: 48px; }

    /* LOADING */
    #loading{position:fixed;inset:0;background:linear-gradient(145deg,var(--green),var(--green-dk));display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;gap:16px;transition:opacity .4s}
    #loading p{color:rgba(255,255,255,.85);font-size:15px;font-weight:600;letter-spacing:.02em}

    /* OFFLINE BANNER */
    #offlineBanner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--red);
      color: var(--white);
      text-align: center;
      font-size: 13px;
      font-weight: 700;
      padding: 8px;
      z-index: 9999;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }
    #offlineBanner.show { transform: translateY(0); }

    /* AUTH */
    #authScreen{display:none;min-height:100vh;background:linear-gradient(145deg,var(--green),var(--green-dk));align-items:center;justify-content:center;padding:24px;position:relative;overflow:hidden}
    #authScreen::before{content:'';position:absolute;width:400px;height:400px;border-radius:50%;background:rgba(255,255,255,.05);top:-100px;right:-100px}
    #authScreen::after{content:'';position:absolute;width:300px;height:300px;border-radius:50%;background:rgba(255,255,255,.04);bottom:-80px;left:-80px}
    #authScreen.active{display:flex}
    .auth-card{background:var(--white);border-radius:24px;padding:40px 32px;max-width:400px;width:100%;box-shadow:var(--sh-lg);animation:slideUp .4s ease;position:relative;z-index:1}
    .auth-logo{text-align:center;margin-bottom:28px}
    .auth-logo .cow-svg{width:80px; height:80px; display:block; margin:0 auto 10px; animation:float 3s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    .auth-logo h1{font-size:30px;color:var(--stone);margin-bottom:4px}
    .auth-logo p{color:var(--muted);font-size:13px}
    .auth-tabs{display:flex;background:var(--cream);border-radius:12px;padding:4px;margin-bottom:24px;gap:4px}
    .auth-tab{flex:1;padding:10px;border:none;background:none;border-radius:10px;cursor:pointer;font-size:14px;font-weight:700;font-family:inherit;color:var(--muted);transition:all .2s}
    .auth-tab.active{background:var(--white);color:var(--green);box-shadow:0 2px 8px rgba(0,0,0,.05)}

    /* APP */
    #app{display:none;min-height:100vh;padding-bottom:84px}
    #app.active{display:block}

    /* HEADER */
    .header{background:linear-gradient(135deg,var(--green),var(--green-dk));color:var(--white);padding:14px 20px 0;position:sticky;top:0;z-index:100;box-shadow:0 2px 20px rgba(0,0,0,.15)}
    .header-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .header-logo{display:flex;align-items:center;gap:10px}
    .header-logo .cow-svg{width:32px; height:32px;}
    .header-logo h1{font-size:21px;color:var(--white)}
    .header-right{display:flex;align-items:center;gap:8px}
    .user-avatar{width:34px;height:34px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:var(--white);border:2px solid rgba(255,255,255,.4)}
    .btn-logout{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);color:var(--white);border-radius:8px;padding:6px 12px;font-size:12px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .2s}
    
    .nav-tabs{display:flex;gap:4px;padding-bottom:0}
    .nav-tab{flex:1;padding:10px 4px 12px;background:rgba(255,255,255,.08);border:none;border-radius:12px 12px 0 0;color:rgba(255,255,255,.6);cursor:pointer;font-size:11px;font-weight:700;font-family:inherit;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all .2s;border-bottom:3px solid transparent; position: relative; overflow: hidden;}
    .nav-tab .nav-icon{font-size:18px; display: flex; align-items: center; justify-content: center;}
    .nav-tab.active{background:rgba(255,255,255,.18);color:var(--white);border-bottom-color:var(--white)}

    /* RIPPLE EFFECT */
    .btn, .fab, .nav-tab { position: relative; overflow: hidden; }
    .btn::after, .fab::after, .nav-tab::after {
      content: ""; position: absolute; top: 50%; left: 50%; width: 0; height: 0;
      background: rgba(255, 255, 255, 0.2); border-radius: 50%; transform: translate(-50%, -50%);
      transition: width 0.4s ease-out, height 0.4s ease-out, opacity 0.5s ease-out; opacity: 0;
    }
    .btn:active::after, .fab:active::after, .nav-tab:active::after { width: 200px; height: 200px; opacity: 1; transition: 0s; }

    /* CONTENT */
    .content{padding:20px;max-width:640px;margin:0 auto}
    .tab-content{display:none;animation:fadeIn .3s ease}
    .tab-content.active{display:block}

    /* FORM */
    .form-group{margin-bottom:16px}
    .form-label{display:block;font-size:11px;font-weight:700;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:.06em}
    .form-input{width:100%;padding:14px;border:2px solid var(--border);border-radius:var(--r);font-size:15px;font-family:inherit;color:var(--stone);background:var(--white);outline:none;transition:all .2s}
    .form-input:focus{border-color:var(--green);box-shadow:0 0 0 4px var(--green-lt)}

    /* BUTTONS */
    .btn{padding:14px 20px;border:none;border-radius:var(--r);font-size:15px;font-weight:700;font-family:inherit;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;justify-content:center;gap:8px}
    .btn-primary{background:var(--green);color:var(--white);width:100%; box-shadow: 0 4px 12px rgba(22,163,74,0.25);}
    .btn-primary:hover{background:var(--green-mid);transform:translateY(-1px)}
    .btn-secondary{background:var(--cream);color:var(--stone);border:2px solid var(--border)}
    .btn-danger{background:var(--red);color:var(--white)}
    .btn-sm{padding:8px 14px;font-size:13px;border-radius:10px}
    .btn-icon{width:40px;height:40px;padding:0;border-radius:12px;font-size:15px}

    /* ALERTS */
    .alert{padding:14px 16px;border-radius:var(--r);margin-bottom:16px;font-size:14px;font-weight:600;display:none;animation:slideDown .3s ease}
    .alert.show{display:block}
    .alert-success{background:var(--green-lt);color:var(--green-dk);border:1px solid #86efac}
    .alert-error{background:var(--red-lt);color:var(--red);border:1px solid #fca5a5}

    /* TOAST */
    #toast{position:fixed;bottom:96px;left:50%;transform:translateX(-50%) translateY(16px);background:var(--stone);color:var(--white);padding:12px 24px;border-radius:99px;font-size:14px;font-weight:600;opacity:0;transition:all .3s;z-index:9000;white-space:nowrap;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,.2); display: flex; align-items: center; gap: 10px;}
    #toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .check-svg { width: 20px; height: 20px; }
    .check-circle { stroke-dasharray: 166; stroke-dashoffset: 166; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
    .check-path { stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.6s forwards; }
    @keyframes stroke { 100% { stroke-dashoffset: 0; } }

    /* RECORDS */
    .records-toolbar{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
    .search-input{flex:1 1 140px;padding:12px 16px;border:2px solid var(--border);border-radius:var(--r);font-size:14px;font-family:inherit;color:var(--stone);background:var(--white);outline:none;transition:border .2s}
    .search-input:focus{border-color:var(--green)}
    .filter-select{padding:12px 14px;border:2px solid var(--border);border-radius:var(--r);font-size:14px;font-family:inherit;color:var(--stone);background:var(--white);outline:none;cursor:pointer}
    .summary-bar{background:linear-gradient(135deg,var(--green-lt),#bbf7d0);border-radius:var(--r);padding:12px 18px;display:flex;gap:16px;font-size:13px;font-weight:700;color:var(--green-dk);margin-bottom:16px;flex-wrap:wrap;border:1px solid #86efac; align-items: center;}
    .summary-item { display: flex; align-items: center; gap: 6px; }
    
    .record-card{background:var(--white);border:2px solid var(--border);border-left:6px solid var(--green);border-radius:var(--r);padding:18px;margin-bottom:12px;display:flex;align-items:center;gap:14px;box-shadow:var(--sh);animation:slideUp .25s ease;transition:all .2s}
    .record-card:hover{box-shadow:0 8px 32px rgba(0,0,0,.08);transform:translateY(-2px)}
    .record-info{flex:1;min-width:0}
    .record-name{font-size:18px;font-weight:700;color:var(--stone);margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .record-meta{display:flex;gap:12px;flex-wrap:wrap;font-size:13px;color:var(--muted); align-items: center;}
    .record-meta .liters{color:var(--blue);font-weight:700; display: flex; align-items: center; gap: 4px;}
    .record-meta .money{color:var(--gold);font-weight:700; display: flex; align-items: center; gap: 4px;}
    .record-meta .date-meta { display: flex; align-items: center; gap: 4px; }
    .record-actions{display:flex;gap:8px;flex-shrink:0}

    /* FAB */
    .fab{position:fixed;bottom:90px;right:20px;width:62px;height:62px;border-radius:50%;background:var(--green);color:var(--white);border:none;cursor:pointer;box-shadow:0 8px 24px rgba(22,163,74,.4);display:flex;align-items:center;justify-content:center;transition:all .2s;z-index:500}
    .fab:hover{transform:scale(1.1);box-shadow:0 12px 32px rgba(22,163,74,.5)}
    .fab svg { width: 30px; height: 30px; fill: none; stroke: currentColor; stroke-width: 3; stroke-linecap: round; }

    /* MODAL */
    .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);align-items:flex-end;justify-content:center;z-index:800;padding:0; backdrop-filter: blur(4px);}
    .modal-overlay.active{display:flex;animation:fadeIn .2s ease}
    .modal{background:var(--white);border-radius:28px 28px 0 0;padding:28px 24px 36px;width:100%;max-width:480px;max-height:92vh;overflow-y:auto;animation:slideUp .3s ease}
    .modal-handle{width:40px;height:5px;background:var(--border);border-radius:3px;margin:0 auto 24px}
    .modal-title{font-size:22px;font-weight:800;color:var(--stone);margin-bottom:24px;font-family:'Playfair Display',serif}

    /* REPORTS */
    .report-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:14px;margin-bottom:24px}
    .report-card{background:var(--white);padding:20px;border-radius:var(--r);border:2px solid var(--border);box-shadow:var(--sh); transition: transform .2s;}
    .report-card:hover { transform: translateY(-3px); }
    .report-card h4{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:10px}
    .report-card .val{font-size:22px;font-weight:800;color:var(--stone); display: flex; align-items: center; gap: 8px;}
    .report-card.primary{border-left:5px solid var(--green)}
    .report-card.blue{border-left:5px solid var(--blue)}
    .report-card.gold{border-left:5px solid var(--gold)}

    /* BOT */
    .bot-card{background:var(--white);border-radius:var(--r);border:2px solid var(--border);padding:18px;margin-bottom:24px;box-shadow:var(--sh);position:relative;overflow:hidden}
    .bot-card::before{content:'';position:absolute;top:0;left:0;width:5px;height:100%;background:var(--purple)}
    .bot-header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .bot-avatar{width:36px;height:36px;background:var(--purple);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--white);font-size:20px}
    .bot-header h3{font-size:17px;color:var(--stone)}
    .bot-msg{font-size:15px;line-height:1.6;color:var(--stone);background:var(--cream);padding:14px;border-radius:0 16px 16px 16px;margin-bottom:12px}
    .typing-indicator { display: flex; gap: 4px; padding: 6px 4px; }
    .typing-dot { width: 6px; height: 6px; background: var(--muted); border-radius: 50%; animation: typing 1s infinite; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

    /* ANIMATIONS */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    
    /* TRANSITION */
    #pageTransition{position:fixed;inset:0;background:var(--green-dk);z-index:9999;transform:translateX(100%);transition:transform .5s cubic-bezier(0.77,0,0.175,1);display:flex;align-items:center;justify-content:center}
    #pageTransition.active{transform:translateX(0)}
  </style>
</head>
<body>

  <!-- OFFLINE BANNER -->
  <div id="offlineBanner">Voc√™ est√° offline. Verifique a conex√£o.</div>

  <!-- SVG SPRITES -->
  <svg style="display: none;">
    <symbol id="icon-cow" viewBox="0 0 100 100">
      <path d="M20,40 Q20,20 50,20 Q80,20 80,40 L80,70 Q80,85 65,85 L35,85 Q20,85 20,70 Z" fill="#fff" stroke="#14532d" stroke-width="3"/>
      <circle cx="35" cy="45" r="4" fill="#14532d"/>
      <circle cx="65" cy="45" r="4" fill="#14532d"/>
      <path d="M40,65 Q50,75 60,65" fill="none" stroke="#14532d" stroke-width="3" stroke-linecap="round"/>
      <path d="M25,30 Q15,25 20,15 Q25,10 35,20" fill="#ffc1cc" stroke="#14532d" stroke-width="2"/>
      <path d="M75,30 Q85,25 80,15 Q75,10 65,20" fill="#ffc1cc" stroke="#14532d" stroke-width="2"/>
    </symbol>
    <symbol id="icon-milk-anim" viewBox="0 0 100 100">
      <defs>
        <clipPath id="milk-clip">
          <path d="M35,30 C35,20 65,20 65,30 L65,40 C65,45 75,55 75,85 C75,95 25,95 25,85 C25,55 35,45 35,40 Z" />
        </clipPath>
      </defs>
      <path d="M35,30 C35,20 65,20 65,30 L65,40 C65,45 75,55 75,85 C75,95 25,95 25,85 C25,55 35,45 35,40 Z" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
      <rect x="30" y="12" width="40" height="8" rx="4" fill="#14532d" />
      <rect x="0" y="100" width="100" height="100" fill="currentColor" opacity="0.3" clip-path="url(#milk-clip)">
        <animate attributeName="y" values="100;45;100" dur="4s" repeatCount="indefinite" />
      </rect>
    </symbol>
    <symbol id="icon-money" viewBox="0 0 100 100">
      <rect x="15" y="30" width="70" height="45" rx="5" fill="none" stroke="currentColor" stroke-width="6"/>
      <circle cx="50" cy="52.5" r="12" fill="none" stroke="currentColor" stroke-width="5"/>
      <path d="M30,40 L35,40 M65,40 L70,40 M30,65 L35,65 M65,65 L70,65" stroke="currentColor" stroke-width="5" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-calendar" viewBox="0 0 100 100">
      <rect x="20" y="25" width="60" height="55" rx="8" fill="none" stroke="currentColor" stroke-width="7"/>
      <path d="M20,45 L80,45 M35,15 L35,35 M65,15 L65,35" stroke="currentColor" stroke-width="7" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-plus" viewBox="0 0 100 100">
      <line x1="50" y1="25" x2="50" y2="75" stroke="currentColor" stroke-width="10" stroke-linecap="round"/>
      <line x1="25" y1="50" x2="75" y2="50" stroke="currentColor" stroke-width="10" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-edit" viewBox="0 0 100 100">
      <path d="M25,75 L35,75 L75,35 L65,25 L25,65 Z" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="icon-trash" viewBox="0 0 100 100">
      <path d="M25,35 L30,85 Q30,90 35,90 L65,90 Q70,90 75,85 L80,35" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M20,35 L80,35 M40,35 L40,25 Q40,20 45,20 L55,20 Q60,20 60,25 L60,35" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-home" viewBox="0 0 100 100">
      <path d="M20,45 L50,20 L80,45 L80,85 L60,85 L60,60 L40,60 L40,85 L20,85 Z" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="icon-chart" viewBox="0 0 100 100">
      <path d="M20,80 L80,80 M30,80 L30,50 M50,80 L50,30 M70,80 L70,60" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="icon-settings" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="12" fill="none" stroke="currentColor" stroke-width="7"/>
      <path d="M50,20 L50,30 M50,70 L50,80 M20,50 L30,50 M70,50 L80,50 M28,28 L35,35 M65,65 L72,72 M28,72 L35,65 M65,35 L72,28" stroke="currentColor" stroke-width="8" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-package" viewBox="0 0 100 100">
      <path d="M20,35 L50,20 L80,35 L80,70 L50,85 L20,70 Z" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M20,35 L50,50 L80,35 M50,50 L50,85" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
    </symbol>
  </svg>

  <div id="loading">
    <svg width="80" height="80" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <path d="M50,15 C50,15 25,55 25,70 A25,25 0 0,0 75,70 C75,55 50,15 50,15 Z" fill="#ffffff">
        <animateTransform attributeName="transform" type="translate" values="0,0; 0,-15; 0,0" dur="1.2s" repeatCount="indefinite" />
        <animate attributeName="opacity" values="1;0.8;1" dur="1.2s" repeatCount="indefinite" />
      </path>
      <ellipse cx="50" cy="92" rx="20" ry="4" fill="#000000" opacity="0.15">
        <animate attributeName="rx" values="20;12;20" dur="1.2s" repeatCount="indefinite" />
        <animate attributeName="opacity" values="0.15;0.05;0.15" dur="1.2s" repeatCount="indefinite" />
      </ellipse>
    </svg>
    <p>Carregando Leite Certo‚Ä¶</p>
  </div>

  <div id="pageTransition">
    <svg width="80" height="80" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <path d="M50,15 C50,15 25,55 25,70 A25,25 0 0,0 75,70 C75,55 50,15 50,15 Z" fill="#ffffff">
        <animateTransform attributeName="transform" type="translate" values="0,0; 0,-15; 0,0" dur="1s" repeatCount="indefinite" />
      </path>
    </svg>
  </div>

  <!-- AUTH SCREEN -->
  <div id="authScreen">
    <div class="auth-card">
      <div class="auth-logo">
        <svg class="cow-svg"><use href="#icon-cow"/></svg>
        <h1>Leite Certo</h1>
        <p>Gest√£o simples para produtores</p>
      </div>
      
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuth('login')">Entrar</button>
        <button class="auth-tab" onclick="switchAuth('signup')">Criar Conta</button>
      </div>

      <div id="authAlert" class="alert"></div>

      <div id="loginForm">
        <div class="form-group">
          <label class="form-label">E-mail</label>
          <input type="email" id="loginEmail" class="form-input" placeholder="seu@email.com">
        </div>
        <div class="form-group">
          <label class="form-label">Senha</label>
          <input type="password" id="loginPass" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button id="btnLoginSubmit" class="btn btn-primary" onclick="doLogin()">Entrar</button>
      </div>

      <div id="signupForm" style="display:none">
        <div class="form-group">
          <label class="form-label">Nome Completo</label>
          <input type="text" id="signupName" class="form-input" placeholder="Como quer ser chamado?">
        </div>
        <div class="form-group">
          <label class="form-label">E-mail</label>
          <input type="email" id="signupEmail" class="form-input" placeholder="seu@email.com">
        </div>
        <div class="form-group">
          <label class="form-label">Senha</label>
          <input type="password" id="signupPass" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button class="btn btn-primary" onclick="doSignup()">Criar Minha Conta</button>
      </div>
    </div>
  </div>

  <!-- APP SCREEN -->
  <div id="app">
    <header class="header">
      <div class="header-top">
        <div class="header-logo">
          <svg class="cow-svg"><use href="#icon-cow"/></svg>
          <h1>Leite Certo</h1>
        </div>
        <div class="header-right">
          <div id="userAvatar" class="user-avatar">?</div>
          <button class="btn-logout" onclick="doLogout()">Sair</button>
        </div>
      </div>
      <nav class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('home')">
          <span class="nav-icon"><svg class="svg-icon"><use href="#icon-home"/></svg></span>
          In√≠cio
        </button>
        <button class="nav-tab" onclick="switchTab('records')">
          <span class="nav-icon"><svg class="svg-icon"><use href="#icon-package"/></svg></span>
          Entregas
        </button>
        <button class="nav-tab" onclick="switchTab('reports')">
          <span class="nav-icon"><svg class="svg-icon"><use href="#icon-chart"/></svg></span>
          Relat√≥rios
        </button>
        <button class="nav-tab" onclick="switchTab('settings')">
          <span class="nav-icon"><svg class="svg-icon"><use href="#icon-settings"/></svg></span>
          Ajustes
        </button>
      </nav>
    </header>

    <main class="content">
      <div id="tab-home" class="tab-content active">
        <div id="botContainer"></div>
        
        <h3 style="margin-bottom:16px">Resumo do M√™s</h3>
        <div class="report-grid">
          <div class="report-card primary">
            <h4>Total Litros</h4>
            <div id="hTotalLiters" class="val">
              <svg class="svg-icon-sm" style="color:var(--blue)"><use href="#icon-milk-anim"/></svg>
              <span>0 L</span>
            </div>
          </div>
          <div class="report-card gold">
            <h4>Total Valor</h4>
            <div id="hTotalMoney" class="val">
              <svg class="svg-icon-sm" style="color:var(--gold)"><use href="#icon-money"/></svg>
              <span>R$ 0,00</span>
            </div>
          </div>
        </div>
      </div>

      <div id="tab-records" class="tab-content">
        <div class="records-toolbar">
          <input type="text" id="searchInput" class="search-input" placeholder="Buscar comprador..." oninput="renderRecords()">
          <select id="monthFilter" class="filter-select" onchange="renderRecords()">
            <option value="">Todos os meses</option>
          </select>
        </div>
        <div id="summaryBar" class="summary-bar"></div>
        <div id="recordsList"></div>
      </div>

      <div id="tab-reports" class="tab-content">
        <h2 style="margin-bottom:20px">Relat√≥rios</h2>
        <div class="report-grid">
          <div class="report-card primary">
            <h4>Litros Produzidos</h4>
            <div id="rTotalLiters" class="val">0 L</div>
          </div>
          <div class="report-card gold">
            <h4>Faturamento Total</h4>
            <div id="rTotalMoney" class="val">R$ 0,00</div>
          </div>
        </div>
      </div>

      <div id="tab-settings" class="tab-content">
        <h2 style="margin-bottom:20px">Ajustes</h2>
        <div style="background:var(--white); border-radius:var(--r); border:2px solid var(--border); overflow:hidden">
          <div style="padding:16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center">
            <div>
              <div style="font-weight:700">Modo Escuro</div>
              <div style="font-size:12px; color:var(--muted)">Em breve</div>
            </div>
            <div style="width:40px; height:20px; background:var(--border); border-radius:10px"></div>
          </div>
          <div style="padding:16px; color:var(--red); font-weight:700; cursor:pointer" onclick="doLogout()">Sair da Conta</div>
        </div>
      </div>
    </main>

    <button class="fab" onclick="openModal()">
      <svg><use href="#icon-plus"/></svg>
    </button>
  </div>

  <!-- MODAL -->
  <div id="modalOverlay" class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal">
      <div class="modal-handle"></div>
      <h2 id="modalTitle" class="modal-title">Nova Entrega</h2>
      
      <div class="form-group">
        <label class="form-label">Comprador / Local</label>
        <input type="text" id="fPerson" class="form-input" placeholder="Ex: Latic√≠nio Central">
      </div>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
        <div class="form-group">
          <label class="form-label">Quantidade (Litros)</label>
          <input type="number" id="fQty" class="form-input" step="0.1" placeholder="0.0">
        </div>
        <div class="form-group">
          <label class="form-label">Pre√ßo por Litro (R$)</label>
          <input type="text" inputmode="numeric" id="fPrice" class="form-input" placeholder="0,00">
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Data da Entrega</label>
        <input type="date" id="fDate" class="form-input">
      </div>

      <div class="modal-actions" style="display:flex; gap:12px; margin-top:24px">
        <button class="btn btn-secondary" style="flex:1" onclick="closeModal()">Cancelar</button>
        <button class="btn btn-primary" style="flex:2" onclick="saveRecord()">üíæ Salvar</button>
      </div>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // L√ìGICA ORIGINAL (MANTIDA)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const SB_URL = "https://your-project.supabase.co";
    const SB_KEY = "your-anon-key";
    const sb = supabase.createClient(SB_URL, SB_KEY);

    let records = [];
    let editingId = null;

    // M√ÅSCARA DE MOEDA (LAYOUT)
    document.getElementById('fPrice').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value === '') { e.target.value = ''; return; }
      value = (parseInt(value, 10) / 100).toFixed(2).replace('.', ',');
      e.target.value = value;
    });

    // STATUS ONLINE/OFFLINE (LAYOUT)
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    function updateOnlineStatus() {
      const banner = document.getElementById('offlineBanner');
      const saveBtn = document.querySelector('.modal-actions .btn-primary');
      if (navigator.onLine) {
        banner.classList.remove('show');
        if (saveBtn) saveBtn.disabled = false;
      } else {
        banner.classList.add('show');
        if (saveBtn) saveBtn.disabled = true;
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('fDate').valueAsDate = new Date();
      sb.auth.onAuthStateChange(async (e, s) => {
        const l = document.getElementById('loading');
        l.style.opacity = '0';
        setTimeout(() => l.style.display = 'none', 400);
        if (e === 'SIGNED_IN' && s) await startApp(s.user);
        else if (e === 'SIGNED_OUT') showAuth();
      });
    });

    async function startApp(user){
      const tr = document.getElementById('pageTransition');
      tr.classList.add('active');
      await loadRecords();
      setTimeout(() => {
        document.getElementById('authScreen').classList.remove('active');
        document.getElementById('app').classList.add('active');
        document.getElementById('userAvatar').textContent = (user.email||'?')[0].toUpperCase();
        initBot();
        updateReports();
        setTimeout(() => tr.classList.remove('active'), 400);
      }, 600);
    }

    function showAuth(){
      document.getElementById('app').classList.remove('active');
      document.getElementById('authScreen').classList.add('active');
    }

    function switchAuth(tab){
      ['loginForm','signupForm'].forEach(id => document.getElementById(id).style.display = 'none');
      document.getElementById(tab === 'signup' ? 'signupForm' : 'loginForm').style.display = 'block';
      document.querySelectorAll('.auth-tab').forEach((b,i) => b.classList.toggle('active',(i===0&&tab==='login')||(i===1&&tab==='signup')));
    }

    async function doLogin(){
      const email = document.getElementById('loginEmail').value.trim();
      const pass  = document.getElementById('loginPass').value;
      if (!email||!pass) return;
      const { error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) alert('Erro no login');
    }

    async function doSignup(){
      const email = document.getElementById('signupEmail').value.trim();
      const pass = document.getElementById('signupPass').value;
      if (!email || !pass) return;
      const { error } = await sb.auth.signUp({ email, password: pass });
      if (error) alert('Erro no cadastro');
    }

    async function doLogout(){
      if (confirm('Sair?')) await sb.auth.signOut();
    }

    async function loadRecords(){
      const { data:{ user } } = await sb.auth.getUser();
      if (!user) return;
      const { data, error } = await sb.from('entregas').select('*').eq('user_id', user.id).order('date',{ ascending:false });
      if (!error && data) records = data;
      renderRecords();
      populateMonthFilter();
    }

    function renderRecords(){
      const search = (document.getElementById('searchInput')?.value||'').toLowerCase();
      const month  = document.getElementById('monthFilter')?.value||'';
      const list   = records.filter(r => r.person.toLowerCase().includes(search) && (month ? r.date.startsWith(month) : true));
      
      const tL = list.reduce((s,r)=>s+r.quantity,0);
      const tR = list.reduce((s,r)=>s+r.quantity*(r.price||0),0);
      
      const bar = document.getElementById('summaryBar');
      if (list.length > 0){
        bar.style.display = 'flex';
        bar.innerHTML = `
          <div class="summary-item"><svg class="svg-icon-sm"><use href="#icon-package"/></svg> ${list.length} entregas</div>
          <div class="summary-item"><svg class="svg-icon-sm"><use href="#icon-milk-anim"/></svg> ${tL.toFixed(1)} L</div>
          ${tR>0?`<div class="summary-item"><svg class="svg-icon-sm"><use href="#icon-money"/></svg> R$ ${tR.toFixed(2)}</div>`:''}
        `;
      } else { bar.style.display = 'none'; }

      const el = document.getElementById('recordsList');
      el.innerHTML = list.map(r => `
        <div class="record-card">
          <div class="record-info">
            <div class="record-name">${r.person}</div>
            <div class="record-meta">
              <span class="liters"><svg class="svg-icon-sm"><use href="#icon-milk-anim"/></svg> ${r.quantity} L</span>
              <span class="date-meta"><svg class="svg-icon-sm"><use href="#icon-calendar"/></svg> ${r.date.split('-').reverse().join('/')}</span>
            </div>
          </div>
          <div class="record-actions">
            <button class="btn btn-secondary btn-icon" onclick="openModal('${r.id}')"><svg class="svg-icon-sm"><use href="#icon-edit"/></svg></button>
            <button class="btn btn-secondary btn-icon" style="color:var(--red)" onclick="deleteRecord('${r.id}')"><svg class="svg-icon-sm"><use href="#icon-trash"/></svg></button>
          </div>
        </div>
      `).join('');
    }

    async function saveRecord(){
      const person = document.getElementById('fPerson').value.trim();
      const qty = parseFloat(document.getElementById('fQty').value);
      const price = parseFloat(document.getElementById('fPrice').value.replace(',', '.')) || 0;
      const date = document.getElementById('fDate').value;
      if (!person || !qty || !date) { toast('Preencha tudo!'); return; }
      
      const { data:{ user } } = await sb.auth.getUser();
      const payload = { user_id: user.id, person, quantity: qty, price, date };
      
      const { error } = editingId ? await sb.from('entregas').update(payload).eq('id', editingId) : await sb.from('entregas').insert(payload);
      
      if (error) toast('Erro ao salvar');
      else {
        toast(editingId ? 'Atualizado!' : 'Salvo!', 'success');
        closeModal();
        await loadRecords();
        updateReports();
      }
    }

    // L√ìGICA DE DELETE ORIGINAL (MANTIDA)
    async function deleteRecord(id){
      if (confirm('Apagar?')) {
        const { error } = await sb.from('entregas').delete().eq('id', id);
        if (!error) { toast('Apagado'); await loadRecords(); updateReports(); }
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // UI UTILS (LAYOUT)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function switchTab(tab){
      document.querySelectorAll('.nav-tab').forEach((b,i) => {
        const tabs = ['home','records','reports','settings'];
        b.classList.toggle('active', tabs[i] === tab);
      });
      document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.toggle('active', c.id === `tab-${tab}`);
      });
      if(tab === 'reports') updateReports();
    }

    function openModal(id = null){
      editingId = id;
      document.getElementById('modalTitle').textContent = id ? 'Editar Entrega' : 'Nova Entrega';
      if (id) {
        const r = records.find(x => x.id === id);
        document.getElementById('fPerson').value = r.person;
        document.getElementById('fQty').value = r.quantity;
        document.getElementById('fPrice').value = r.price.toFixed(2).replace('.', ',');
        document.getElementById('fDate').value = r.date;
      } else {
        document.getElementById('fPerson').value = '';
        document.getElementById('fQty').value = '';
        document.getElementById('fPrice').value = '';
        document.getElementById('fDate').valueAsDate = new Date();
      }
      document.getElementById('modalOverlay').classList.add('active');
    }

    function closeModal(){ document.getElementById('modalOverlay').classList.remove('active'); }

    function toast(msg, type='info'){
      const t = document.getElementById('toast');
      if (type === 'success') {
        t.innerHTML = `
          <svg class="check-svg" viewBox="0 0 52 52">
            <circle class="check-circle" cx="26" cy="26" r="25" fill="none" stroke="white" stroke-width="2"/>
            <path class="check-path" fill="none" stroke="white" stroke-width="3" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
          </svg>
          <span>${msg}</span>
        `;
      } else {
        t.textContent = msg;
      }
      t.style.background = type === 'success' ? 'var(--green)' : 'var(--stone)';
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    function updateReports(){
      const now = new Date();
      const monthStr = now.toISOString().substring(0,7);
      const monthRecords = records.filter(r => r.date.startsWith(monthStr));
      const tL = monthRecords.reduce((s,r)=>s+r.quantity,0);
      const tM = monthRecords.reduce((s,r)=>s+r.quantity*(r.price||0),0);
      
      const hL = document.getElementById('hTotalLiters');
      const hM = document.getElementById('hTotalMoney');
      if(hL) hL.querySelector('span').textContent = tL.toFixed(1) + ' L';
      if(hM) hM.querySelector('span').textContent = 'R$ ' + tM.toFixed(2).replace('.', ',');
      
      if (document.getElementById('tab-reports').classList.contains('active')) {
        const allL = records.reduce((s,r)=>s+r.quantity,0);
        const allM = records.reduce((s,r)=>s+r.quantity*(r.price||0),0);
        document.getElementById('rTotalLiters').textContent = allL.toFixed(1) + ' L';
        document.getElementById('rTotalMoney').textContent = 'R$ ' + allM.toFixed(2).replace('.', ',');
      }
    }

    function populateMonthFilter(){
      const select = document.getElementById('monthFilter');
      const months = [...new Set(records.map(r => r.date.substring(0,7)))].sort().reverse();
      select.innerHTML = '<option value="">Todos os meses</option>' + 
        months.map(m => `<option value="${m}">${m.split('-').reverse().join('/')}</option>`).join('');
    }

    function initBot(){
      const container = document.getElementById('botContainer');
      container.innerHTML = `
        <div class="bot-card">
          <div class="bot-header">
            <div class="bot-avatar">ü§ñ</div>
            <h3>Assistente Leite Certo</h3>
          </div>
          <div class="bot-msg">
            <div class="typing-indicator">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        </div>
      `;
      setTimeout(() => {
        const msg = container.querySelector('.bot-msg');
        if(msg) msg.textContent = "Ol√°! Como est√° a produ√ß√£o hoje? J√° registrou as entregas?";
      }, 1500);
    }
  </script>
</body>
</html>
